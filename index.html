<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Classic Storefront</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style id="app-style">
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #6366f1;
            --accent-color: #818cf8;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .header-shadow {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .product-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .cart-panel {
            height: calc(100vh - 80px);
            transition: right 0.3s ease;
        }

        .toast-notification {
            background-color: var(--primary-color);
            color: white;
            border-radius: 4px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 9999;
        }

        .overlay {
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(2px);
        }

        .modal {
            max-height: 90vh;
            overflow-y: auto;
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        .pagination-button.active {
            background-color: var(--primary-color);
            color: white;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Media queries */
        @media (max-width: 640px) {
            .product-grid {
                grid-template-columns: repeat(1, 1fr);
            }

            .cart-panel {
                width: 100%;
            }
        }

        @media (min-width: 641px) and (max-width: 1024px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .cart-panel {
                width: 400px;
            }
        }

        @media (min-width: 1025px) {
            .product-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .cart-panel {
                width: 400px;
            }
        }

        /* Custom animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="bg-white header-shadow sticky top-0 z-30">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <a href="javascript:void(0)" class="text-2xl font-bold text-indigo-600">ClassicStore</a>
                <div class="flex items-center space-x-6">
                    <a href="javascript:void(0)" id="order-history-link"
                        class="hidden md:block hover:text-indigo-600 transition">
                        Order History
                    </a>
                    <button id="admin-toggle" class="hidden md:block text-gray-600 hover:text-indigo-600 transition">
                        Admin Dashboard
                    </button>
                    <div class="relative">
                        <button id="cart-button" class="text-gray-600 hover:text-indigo-600 transition">
                            <i class="fas fa-shopping-cart text-xl"></i>
                            <span id="cart-count"
                                class="absolute -top-2 -right-2 bg-indigo-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">0</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="md:hidden mt-4 flex flex-col space-y-2">
                <a href="javascript:void(0)" id="mobile-order-history" class="hover:text-indigo-600 transition">
                    Order History
                </a>
                <button id="mobile-admin-toggle" class="text-left text-gray-600 hover:text-indigo-600 transition">
                    Admin Dashboard
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Product Catalog (default view) -->
        <section id="product-catalog" class="mb-12">
            <h2 class="text-3xl font-bold mb-6">Product Catalog</h2>
            <div id="loading-products" class="flex justify-center py-12">
                <div class="loading-spinner"></div>
            </div>
            <div id="products-grid" class="grid product-grid gap-6"></div>
        </section>

        <!-- Admin Dashboard (hidden by default) -->
        <section id="admin-dashboard" class="hidden mb-12">
            <h2 class="text-3xl font-bold mb-6">Admin Dashboard</h2>

            <!-- Add New Product Form -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">Add New Product</h3>
                <form id="add-product-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 mb-1">Product Title</label>
                            <input type="text" name="title" class="w-full border border-gray-300 rounded px-3 py-2"
                                required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1">Price ($)</label>
                            <input type="number" name="price" step="0.01" min="0"
                                class="w-full border border-gray-300 rounded px-3 py-2" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1">Category</label>
                            <select name="category" class="w-full border border-gray-300 rounded px-3 py-2">
                                <option value="electronics">Electronics</option>
                                <option value="jewelery">Jewelry</option>
                                <option value="men's clothing">Men's Clothing</option>
                                <option value="women's clothing">Women's Clothing</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1">Image URL</label>
                            <input type="url" name="image" class="w-full border border-gray-300 rounded px-3 py-2"
                                required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 mb-1">Description</label>
                            <textarea name="description" rows="3"
                                class="w-full border border-gray-300 rounded px-3 py-2" required></textarea>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end">
                        <button type="button" id="cancel-add-product"
                            class="bg-gray-200 text-gray-800 px-4 py-2 rounded mr-2">Cancel</button>
                        <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded">Save Product</button>
                    </div>
                </form>
            </div>

            <!-- Products Table -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-100 text-left">
                                <th class="px-6 py-3 text-gray-700">Image</th>
                                <th class="px-6 py-3 text-gray-700">Title</th>
                                <th class="px-6 py-3 text-gray-700">Price</th>
                                <th class="px-6 py-3 text-gray-700">Category</th>
                                <th class="px-6 py-3 text-gray-700">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="admin-products-table"></tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="px-6 py-4 bg-gray-50 border-t flex justify-center">
                    <div id="pagination" class="flex space-x-2"></div>
                </div>
            </div>
        </section>

        <!-- Order History (hidden by default) -->
        <section id="order-history" class="hidden mb-12">
            <h2 class="text-3xl font-bold mb-6">Order History</h2>
            <div id="no-orders" class="bg-white rounded-lg shadow-md p-6 text-center">
                <p class="text-gray-500">No order history found.</p>
            </div>
            <div id="orders-list" class="space-y-4"></div>
        </section>
    </main>

    <!-- Cart Panel (off-canvas) -->
    <div id="cart-panel"
        class="fixed top-0 right-[-100%] w-full md:w-[400px] bg-white shadow-lg z-40 cart-panel p-6 overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Your Cart</h2>
            <button id="close-cart" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div id="empty-cart" class="text-center py-12">
            <i class="fas fa-shopping-cart text-gray-300 text-5xl mb-4"></i>
            <p class="text-gray-500">Your cart is empty</p>
        </div>

        <div id="cart-items" class="space-y-4 mb-6"></div>

        <div id="cart-summary" class="border-t pt-4 mb-6 hidden">
            <div class="flex justify-between text-lg mb-2">
                <span>Subtotal:</span>
                <span id="cart-subtotal">$0.00</span>
            </div>
            <div class="flex justify-between text-lg font-bold">
                <span>Total:</span>
                <span id="cart-total">$0.00</span>
            </div>
        </div>

        <button id="checkout-button"
            class="w-full bg-indigo-600 text-white py-3 rounded-lg font-medium hidden hover:bg-indigo-700 transition">
            Proceed to Checkout
        </button>
    </div>

    <!-- Modals -->
    <!-- Product Detail Modal -->
    <div id="product-detail-modal" class="hidden fixed inset-0 z-50 overflow-auto">
        <div class="overlay fixed inset-0"></div>
        <div class="relative flex items-center justify-center min-h-screen px-4">
            <div class="modal bg-white rounded-lg shadow-xl max-w-4xl w-full animate-fade-in">
                <div id="product-detail-content" class="p-6"></div>
            </div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div id="edit-product-modal" class="hidden fixed inset-0 z-50 overflow-auto">
        <div class="overlay fixed inset-0"></div>
        <div class="relative flex items-center justify-center min-h-screen px-4">
            <div class="modal bg-white rounded-lg shadow-xl max-w-2xl w-full animate-fade-in">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold">Edit Product</h3>
                        <button class="close-modal text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <form id="edit-product-form">
                        <input type="hidden" name="id">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 mb-1">Product Title</label>
                                <input type="text" name="title" class="w-full border border-gray-300 rounded px-3 py-2"
                                    required>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Price ($)</label>
                                <input type="number" name="price" step="0.01" min="0"
                                    class="w-full border border-gray-300 rounded px-3 py-2" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Category</label>
                                <select name="category" class="w-full border border-gray-300 rounded px-3 py-2">
                                    <option value="electronics">Electronics</option>
                                    <option value="jewelery">Jewelry</option>
                                    <option value="men's clothing">Men's Clothing</option>
                                    <option value="women's clothing">Women's Clothing</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Image URL</label>
                                <input type="url" name="image" class="w-full border border-gray-300 rounded px-3 py-2"
                                    required>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3"
                                    class="w-full border border-gray-300 rounded px-3 py-2" required></textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end">
                            <button type="button"
                                class="close-modal bg-gray-200 text-gray-800 px-4 py-2 rounded mr-2">Cancel</button>
                            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded">Save
                                Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="hidden fixed inset-0 z-50 overflow-auto">
        <div class="overlay fixed inset-0"></div>
        <div class="relative flex items-center justify-center min-h-screen px-4">
            <div class="modal bg-white rounded-lg shadow-xl max-w-2xl w-full animate-fade-in">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold">Complete Your Order</h3>
                        <button class="close-modal text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <form id="checkout-form">
                        <h4 class="text-lg font-semibold mb-3">Shipping Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-gray-700 mb-1">First Name</label>
                                <input type="text" name="firstName"
                                    class="w-full border border-gray-300 rounded px-3 py-2" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Last Name</label>
                                <input type="text" name="lastName"
                                    class="w-full border border-gray-300 rounded px-3 py-2" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Email</label>
                                <input type="email" name="email" class="w-full border border-gray-300 rounded px-3 py-2"
                                    required>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Phone</label>
                                <input type="tel" name="phone" class="w-full border border-gray-300 rounded px-3 py-2"
                                    required>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 mb-1">Address</label>
                                <input type="text" name="address"
                                    class="w-full border border-gray-300 rounded px-3 py-2" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">City</label>
                                <input type="text" name="city" class="w-full border border-gray-300 rounded px-3 py-2"
                                    required>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Postal Code</label>
                                <input type="text" name="postalCode"
                                    class="w-full border border-gray-300 rounded px-3 py-2" required>
                            </div>
                        </div>

                        <h4 class="text-lg font-semibold mb-3">Payment Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 mb-1">Card Number</label>
                                <input type="text" name="cardNumber"
                                    class="w-full border border-gray-300 rounded px-3 py-2"
                                    placeholder="XXXX XXXX XXXX XXXX" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Expiration Date</label>
                                <input type="text" name="expDate"
                                    class="w-full border border-gray-300 rounded px-3 py-2" placeholder="MM/YY"
                                    required>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">CVV</label>
                                <input type="text" name="cvv" class="w-full border border-gray-300 rounded px-3 py-2"
                                    placeholder="XXX" required>
                            </div>
                        </div>

                        <div class="mt-8 flex justify-end">
                            <button type="button"
                                class="close-modal bg-gray-200 text-gray-800 px-4 py-2 rounded mr-2">Cancel</button>
                            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded">Complete
                                Purchase</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Confirmation Modal -->
    <div id="confirmation-modal" class="hidden fixed inset-0 z-50 overflow-auto">
        <div class="overlay fixed inset-0"></div>
        <div class="relative flex items-center justify-center min-h-screen px-4">
            <div class="modal bg-white rounded-lg shadow-xl max-w-md w-full animate-fade-in">
                <div class="p-6 text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold mb-2">Order Confirmed!</h3>
                    <p class="text-gray-600 mb-6">Your order has been placed successfully.</p>
                    <p class="font-semibold mb-6">Order #: <span id="order-number"></span></p>
                    <button id="close-confirmation" class="bg-indigo-600 text-white px-6 py-2 rounded">Continue
                        Shopping</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="hidden fixed inset-0 z-50 overflow-auto">
        <div class="overlay fixed inset-0"></div>
        <div class="relative flex items-center justify-center min-h-screen px-4">
            <div class="modal bg-white rounded-lg shadow-xl max-w-md w-full animate-fade-in">
                <div class="p-6">
                    <h3 class="text-xl font-bold mb-4">Confirm Deletion</h3>
                    <p class="mb-6">Are you sure you want to delete this product? This action cannot be undone.</p>
                    <div class="flex justify-end">
                        <button class="close-modal bg-gray-200 text-gray-800 px-4 py-2 rounded mr-2">Cancel</button>
                        <button id="confirm-delete-button"
                            class="bg-red-600 text-white px-4 py-2 rounded">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script id="app-script">
        // Mock user data
        const mockUser = {
            id: 1,
            name: "John Doe",
            email: "john.doe@example.com",
            isAdmin: true
        };

        // State management
        const state = {
            products: [],
            cart: [],
            orders: [],
            currentProduct: null,
            currentProductToEdit: null,
            currentProductToDelete: null,
            currentPage: 1,
            itemsPerPage: 5,
            view: 'catalog', // 'catalog', 'admin', 'history'
            isLoading: true
        };

        // Load data from localStorage
        function loadFromLocalStorage() {
            try {
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                state.cart = cart;
                state.orders = orders;
                updateCartCount();
            } catch (error) {
                showToast('Error loading data from local storage', 'error');
                console.error('Error loading from localStorage:', error);
            }
        }

        // Save data to localStorage
        function saveToLocalStorage() {
            try {
                localStorage.setItem('cart', JSON.stringify(state.cart));
                localStorage.setItem('orders', JSON.stringify(state.orders));
            } catch (error) {
                showToast('Error saving data to local storage', 'error');
                console.error('Error saving to localStorage:', error);
            }
        }

        // API functions
        const api = {
            // Get all products
            getProducts: async () => {
                try {
                    state.isLoading = true;
                    renderLoadingState();

                    // In a real app, we'd call the actual Fake Store API
                    // const response = await axios.get('https://fakestoreapi.com/products');
                    // return response.data;

                    // For prototype, return mock data
                    await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate network delay

                    return [
                        {
                            id: 1,
                            title: "Fjallraven - Foldsack No. 1 Backpack",
                            price: 109.95,
                            description: "Your perfect pack for everyday use and walks in the forest. Stash your laptop (up to 15 inches) in the padded sleeve, your everyday",
                            category: "men's clothing",
                            image: "https://images.unsplash.com/photo-1622560481979-f5b0174242a0?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NjkwMjR8MHwxfHNlYXJjaHw0fHxGamFsbHJhdmVuJTIwLSUyMEZvbGRzYWNrJTIwTm8uJTIwMSUyMEJhY2twYWNrfGVufDB8fHx8MTc2MTY2NTkwNnww&ixlib=rb-4.1.0&q=80&w=1080"
                        },
                        {
                            id: 2,
                            title: "Mens Casual Premium Slim Fit T-Shirts",
                            price: 22.3,
                            description: "Slim-fitting style, contrast raglan long sleeve, three-button henley placket, light weight & soft fabric for breathable and comfortable wearing.",
                            category: "men's clothing",
                            image: "https://images.unsplash.com/photo-1666358777552-e9da24998db8?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NjkwMjR8MHwxfHNlYXJjaHwyfHxNZW5zJTIwQ2FzdWFsJTIwUHJlbWl1bSUyMFNsaW0lMjBGaXQlMjBULVNoaXJ0c3xlbnwwfHx8fDE3NjE2NjU5MTR8MA&ixlib=rb-4.1.0&q=80&w=1080"
                        },
                        {
                            id: 3,
                            title: "Mens Cotton Jacket",
                            price: 55.99,
                            description: "Great outerwear jackets for Spring/Autumn/Winter, suitable for many occasions, such as working, hiking, camping, mountain/rock climbing, cycling, traveling or other outdoors.",
                            category: "men's clothing",
                            image: "https://images.unsplash.com/photo-1657212458073-d83c97ac65d1?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NjkwMjR8MHwxfHNlYXJjaHwxfHxNZW5zJTIwQ290dG9uJTIwSmFja2V0fGVufDB8fHx8MTc2MTY2NTg4OHww&ixlib=rb-4.1.0&q=80&w=1080"
                        },
                        {
                            id: 4,
                            title: "Women's 3-in-1 Snowboard Jacket",
                            price: 56.99,
                            description: "Note: The Jackets is US standard size, Please choose size as your usual wear. Material: 100% Polyester; Detachable Liner Fabric: Warm Fleece.",
                            category: "women's clothing",
                            image: "https://images.unsplash.com/photo-1544620862-d47d57948ecc?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NjkwMjR8MHwxfHNlYXJjaHw1fHxXb21lbiUyN3MlMjAzLWluLTElMjBTbm93Ym9hcmQlMjBKYWNrZXR8ZW58MHx8fHwxNzYxNjY1OTI3fDA&ixlib=rb-4.1.0&q=80&w=1080"
                        },
                        {
                            id: 5,
                            title: "Samsung 49-Inch QLED Gaming Monitor",
                            price: 999.99,
                            description: "49 INCH SUPER ULTRAWIDE 32:9 CURVED GAMING MONITOR with dual 27 inch screen side by side QUANTUM DOT (QLED) TECHNOLOGY, HDR support and factory calibration.",
                            category: "electronics",
                            image: "https://images.unsplash.com/photo-1654095923893-6a255e5ed4d3?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NjkwMjR8MHwxfHNlYXJjaHwxfHxTYW1zdW5nJTIwNDktSW5jaCUyMFFMRUQlMjBHYW1pbmclMjBNb25pdG9yfGVufDB8fHx8MTc2MTY2NTg3OHww&ixlib=rb-4.1.0&q=80&w=1080"
                        },
                        {
                            id: 6,
                            title: "White Gold Plated Princess Cut Diamond Earrings",
                            price: 168.00,
                            description: "Classic Created Wedding Engagement Solitaire Diamond Promise Ring for Her. Gifts to spoil your love more for Engagement, Wedding, Anniversary, Valentine's Day...",
                            category: "jewelery",
                            image: "https://images.unsplash.com/photo-1721808085544-1cae3cd034e3?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NjkwMjR8MHwxfHNlYXJjaHw1fHxXaGl0ZSUyMEdvbGQlMjBQbGF0ZWQlMjBQcmluY2VzcyUyMEN1dCUyMERpYW1vbmQlMjBFYXJyaW5nc3xlbnwwfHx8fDE3NjE2NjU4OTd8MA&ixlib=rb-4.1.0&q=80&w=1080"
                        }
                    ];
                } catch (error) {
                    showToast('Failed to fetch products. Please try again later.', 'error');
                    console.error('Error fetching products:', error);
                    return [];
                } finally {
                    state.isLoading = false;
                }
            },

            // Add a new product
            addProduct: async (product) => {
                try {
                    // In a real app, we'd call the actual API
                    // const response = await axios.post('https://fakestoreapi.com/products', product);
                    // return response.data;

                    await new Promise(resolve => setTimeout(resolve, 800)); // Simulate network delay

                    const newProduct = {
                        ...product,
                        id: Math.max(0, ...state.products.map(p => p.id)) + 1
                    };

                    state.products.push(newProduct);
                    return newProduct;
                } catch (error) {
                    showToast('Failed to add product. Please try again.', 'error');
                    console.error('Error adding product:', error);
                    throw error;
                }
            },

            // Update a product
            updateProduct: async (id, product) => {
                try {
                    // In a real app, we'd call the actual API
                    // const response = await axios.put(`https://fakestoreapi.com/products/${id}`, product);
                    // return response.data;

                    await new Promise(resolve => setTimeout(resolve, 800)); // Simulate network delay

                    const index = state.products.findIndex(p => p.id === id);
                    if (index !== -1) {
                        state.products[index] = { ...product, id };
                        return state.products[index];
                    }
                    throw new Error('Product not found');
                } catch (error) {
                    showToast('Failed to update product. Please try again.', 'error');
                    console.error('Error updating product:', error);
                    throw error;
                }
            },

            // Delete a product
            deleteProduct: async (id) => {
                try {
                    // In a real app, we'd call the actual API
                    // const response = await axios.delete(`https://fakestoreapi.com/products/${id}`);
                    // return response.data;

                    await new Promise(resolve => setTimeout(resolve, 800)); // Simulate network delay

                    const index = state.products.findIndex(p => p.id === id);
                    if (index !== -1) {
                        state.products.splice(index, 1);
                        return true;
                    }
                    return false;
                } catch (error) {
                    showToast('Failed to delete product. Please try again.', 'error');
                    console.error('Error deleting product:', error);
                    throw error;
                }
            },

            // Submit an order
            submitOrder: async (orderData) => {
                try {
                    // In a real app, we'd call the actual API
                    // const response = await axios.post('https://api.example.com/orders', orderData);
                    // return response.data;

                    await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate network delay

                    const orderNumber = `ORD-${Date.now().toString().substr(-6)}`;
                    const newOrder = {
                        id: orderNumber,
                        date: new Date().toISOString(),
                        items: [...state.cart],
                        shippingDetails: orderData,
                        status: 'Processing',
                        total: calculateCartTotal()
                    };

                    state.orders.push(newOrder);
                    saveToLocalStorage();

                    return newOrder;
                } catch (error) {
                    showToast('Failed to submit order. Please try again.', 'error');
                    console.error('Error submitting order:', error);
                    throw error;
                }
            }
        };

        // Utility functions
        function formatCurrency(amount) {
            return '$' + parseFloat(amount).toFixed(2);
        }

        function showToast(message, type = 'success') {
            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "right",
                backgroundColor: type === 'success' ? '#4f46e5' : '#ef4444',
                className: "toast-notification"
            }).showToast();
        }

        // Cart functions
        function addToCart(product, quantity = 1) {
            const existingItem = state.cart.find(item => item.id === product.id);

            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                state.cart.push({
                    ...product,
                    quantity
                });
            }

            saveToLocalStorage();
            updateCartCount();
            showToast(`${product.title} added to cart!`);
        }

        function removeFromCart(productId) {
            state.cart = state.cart.filter(item => item.id !== productId);
            saveToLocalStorage();
            updateCartCount();
            renderCart();
        }

        function updateCartItemQuantity(productId, quantity) {
            const item = state.cart.find(item => item.id === productId);
            if (item) {
                item.quantity = Math.max(1, quantity);
                saveToLocalStorage();
                renderCart();
            }
        }

        function calculateCartTotal() {
            return state.cart.reduce((total, item) => {
                return total + (item.price * item.quantity);
            }, 0);
        }

        function updateCartCount() {
            const totalItems = state.cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;

            // Update cart panel elements visibility
            const hasItems = state.cart.length > 0;
            document.getElementById('empty-cart').style.display = hasItems ? 'none' : 'block';
            document.getElementById('cart-items').style.display = hasItems ? 'block' : 'none';
            document.getElementById('cart-summary').style.display = hasItems ? 'flex' : 'none';
            document.getElementById('checkout-button').style.display = hasItems ? 'block' : 'none';
        }

        function clearCart() {
            state.cart = [];
            saveToLocalStorage();
            updateCartCount();
        }

        // Render functions
        function renderLoadingState() {
            const loadingEl = document.getElementById('loading-products');
            if (state.isLoading) {
                loadingEl.style.display = 'flex';
                document.getElementById('products-grid').innerHTML = '';
            } else {
                loadingEl.style.display = 'none';
            }
        }

        function renderProducts() {
            const productsGrid = document.getElementById('products-grid');
            productsGrid.innerHTML = '';

            state.products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card bg-white rounded-lg shadow-md overflow-hidden';
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.title}" class="w-full h-64 object-contain p-4">
                    <div class="p-4">
                        <h3 class="text-lg font-semibold mb-2">${product.title}</h3>
                        <p class="text-gray-600 mb-2 line-clamp-2">${product.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-indigo-600">${formatCurrency(product.price)}</span>
                            <button class="view-product-btn bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700 transition" data-id="${product.id}">
                                View Details
                            </button>
                        </div>
                    </div>
                `;
                productsGrid.appendChild(productCard);
            });

            // Add event listeners to view product buttons
            document.querySelectorAll('.view-product-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const productId = parseInt(button.getAttribute('data-id'));
                    const product = state.products.find(p => p.id === productId);
                    if (product) {
                        openProductDetailModal(product);
                    }
                });
            });
        }

        function renderAdminProductsTable() {
            const tableBody = document.getElementById('admin-products-table');
            tableBody.innerHTML = '';

            // Calculate pagination
            const startIndex = (state.currentPage - 1) * state.itemsPerPage;
            const endIndex = startIndex + state.itemsPerPage;
            const paginatedProducts = state.products.slice(startIndex, endIndex);

            paginatedProducts.forEach(product => {
                const row = document.createElement('tr');
                row.className = 'border-t';
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <img src="${product.image}" alt="${product.title}" class="w-16 h-16 object-contain">
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-medium">${product.title}</div>
                    </td>
                    <td class="px-6 py-4">${formatCurrency(product.price)}</td>
                    <td class="px-6 py-4">${product.category}</td>
                    <td class="px-6 py-4">
                        <div class="flex space-x-2">
                            <button class="edit-product-btn text-blue-600 hover:text-blue-800" data-id="${product.id}">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="delete-product-btn text-red-600 hover:text-red-800" data-id="${product.id}">
                                <i class="fas fa-trash-alt"></i> Delete
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Add event listeners to admin actions
            document.querySelectorAll('.edit-product-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const productId = parseInt(button.getAttribute('data-id'));
                    const product = state.products.find(p => p.id === productId);
                    if (product) {
                        openEditProductModal(product);
                    }
                });
            });

            document.querySelectorAll('.delete-product-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const productId = parseInt(button.getAttribute('data-id'));
                    const product = state.products.find(p => p.id === productId);
                    if (product) {
                        state.currentProductToDelete = product;
                        openDeleteConfirmModal();
                    }
                });
            });

            renderPagination();
        }

        function renderPagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            const totalPages = Math.ceil(state.products.length / state.itemsPerPage);

            // Previous button
            const prevButton = document.createElement('button');
            prevButton.className = 'pagination-button border px-3 py-1 rounded';
            prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevButton.disabled = state.currentPage === 1;
            prevButton.addEventListener('click', () => {
                if (state.currentPage > 1) {
                    state.currentPage--;
                    renderAdminProductsTable();
                }
            });
            pagination.appendChild(prevButton);

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = `pagination-button border px-3 py-1 rounded ${i === state.currentPage ? 'active' : ''}`;
                pageButton.textContent = i;
                pageButton.addEventListener('click', () => {
                    state.currentPage = i;
                    renderAdminProductsTable();
                });
                pagination.appendChild(pageButton);
            }

            // Next button
            const nextButton = document.createElement('button');
            nextButton.className = 'pagination-button border px-3 py-1 rounded';
            nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextButton.disabled = state.currentPage === totalPages;
            nextButton.addEventListener('click', () => {
                if (state.currentPage < totalPages) {
                    state.currentPage++;
                    renderAdminProductsTable();
                }
            });
            pagination.appendChild(nextButton);
        }

        function renderCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            cartItemsContainer.innerHTML = '';

            state.cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'flex items-center border-b pb-4';
                cartItem.innerHTML = `
                    <img src="${item.image}" alt="${item.title}" class="w-20 h-20 object-contain mr-4">
                    <div class="flex-grow">
                        <h4 class="font-medium">${item.title}</h4>
                        <div class="flex items-center mt-2">
                            <button class="decrement-qty bg-gray-200 px-2 py-1 rounded-l" data-id="${item.id}">-</button>
                            <input type="number" min="1" value="${item.quantity}" class="qty-input w-12 text-center border-y py-1" data-id="${item.id}">
                            <button class="increment-qty bg-gray-200 px-2 py-1 rounded-r" data-id="${item.id}">+</button>
                            <span class="ml-4">${formatCurrency(item.price * item.quantity)}</span>
                        </div>
                    </div>
                    <button class="remove-from-cart ml-2 text-red-500" data-id="${item.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                cartItemsContainer.appendChild(cartItem);
            });

            // Update cart totals
            const total = calculateCartTotal();
            document.getElementById('cart-subtotal').textContent = formatCurrency(total);
            document.getElementById('cart-total').textContent = formatCurrency(total);

            // Add event listeners for cart item quantity changes
            document.querySelectorAll('.increment-qty').forEach(button => {
                button.addEventListener('click', () => {
                    const productId = parseInt(button.getAttribute('data-id'));
                    const item = state.cart.find(item => item.id === productId);
                    if (item) {
                        updateCartItemQuantity(productId, item.quantity + 1);
                    }
                });
            });

            document.querySelectorAll('.decrement-qty').forEach(button => {
                button.addEventListener('click', () => {
                    const productId = parseInt(button.getAttribute('data-id'));
                    const item = state.cart.find(item => item.id === productId);
                    if (item && item.quantity > 1) {
                        updateCartItemQuantity(productId, item.quantity - 1);
                    }
                });
            });

            document.querySelectorAll('.qty-input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const productId = parseInt(input.getAttribute('data-id'));
                    const quantity = parseInt(e.target.value);
                    if (!isNaN(quantity) && quantity > 0) {
                        updateCartItemQuantity(productId, quantity);
                    }
                });
            });

            document.querySelectorAll('.remove-from-cart').forEach(button => {
                button.addEventListener('click', () => {
                    const productId = parseInt(button.getAttribute('data-id'));
                    removeFromCart(productId);
                });
            });

            updateCartCount();
        }

        function renderOrderHistory() {
            const noOrdersEl = document.getElementById('no-orders');
            const ordersListEl = document.getElementById('orders-list');

            ordersListEl.innerHTML = '';

            if (state.orders.length === 0) {
                noOrdersEl.style.display = 'block';
                ordersListEl.style.display = 'none';
                return;
            }

            noOrdersEl.style.display = 'none';
            ordersListEl.style.display = 'block';

            state.orders.forEach(order => {
                const orderEl = document.createElement('div');
                orderEl.className = 'bg-white rounded-lg shadow-md overflow-hidden';

                // Format date
                const orderDate = new Date(order.date);
                const formattedDate = orderDate.toLocaleDateString() + ' ' + orderDate.toLocaleTimeString();

                // Create order header
                const orderHeader = document.createElement('div');
                orderHeader.className = 'px-6 py-4 border-b flex justify-between items-center cursor-pointer';
                orderHeader.innerHTML = `
                    <div>
                        <h3 class="font-bold">Order #${order.id}</h3>
                        <p class="text-sm text-gray-500">${formattedDate}</p>
                    </div>
                    <div class="flex items-center">
                        <span class="mr-3 ${order.status === 'Processing' ? 'text-blue-600' :
                        order.status === 'Shipped' ? 'text-green-600' :
                            order.status === 'Delivered' ? 'text-green-700' : 'text-gray-600'
                    }">${order.status}</span>
                        <span class="font-bold">${formatCurrency(order.total)}</span>
                        <i class="fas fa-chevron-down ml-2 transform transition-transform"></i>
                    </div>
                `;

                // Create order details (initially hidden)
                const orderDetails = document.createElement('div');
                orderDetails.className = 'px-6 py-4 hidden';

                let itemsHtml = '';
                order.items.forEach(item => {
                    itemsHtml += `
                        <div class="flex justify-between items-center mb-2">
                            <div class="flex items-center">
                                <img src="${item.image}" alt="${item.title}" class="w-12 h-12 object-contain mr-3">
                                <span>${item.title}  ${item.quantity}</span>
                            </div>
                            <span>${formatCurrency(item.price * item.quantity)}</span>
                        </div>
                    `;
                });

                orderDetails.innerHTML = `
                    <h4 class="font-semibold mb-3">Items</h4>
                    <div class="mb-4">
                        ${itemsHtml}
                    </div>
                    <h4 class="font-semibold mb-2">Shipping Address</h4>
                    <p class="text-gray-700 mb-4">
                        ${order.shippingDetails.firstName} ${order.shippingDetails.lastName}<br>
                        ${order.shippingDetails.address}<br>
                        ${order.shippingDetails.city}, ${order.shippingDetails.postalCode}
                    </p>
                    <div class="flex justify-between pt-3 border-t">
                        <span class="font-semibold">Total:</span>
                        <span class="font-bold">${formatCurrency(order.total)}</span>
                    </div>
                `;

                orderEl.appendChild(orderHeader);
                orderEl.appendChild(orderDetails);
                ordersListEl.appendChild(orderEl);

                // Toggle order details on click
                orderHeader.addEventListener('click', () => {
                    const chevron = orderHeader.querySelector('i');
                    chevron.classList.toggle('rotate-180');

                    if (orderDetails.classList.contains('hidden')) {
                        orderDetails.classList.remove('hidden');
                    } else {
                        orderDetails.classList.add('hidden');
                    }
                });
            });
        }

        // Modal functions
        function openProductDetailModal(product) {
            state.currentProduct = product;

            const modalContent = document.getElementById('product-detail-content');
            modalContent.innerHTML = `
                <div class="flex justify-between items-start">
                    <h2 class="text-2xl font-bold mb-4">${product.title}</h2>
                    <button class="close-modal text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex items-center justify-center">
                        <img src="${product.image}" alt="${product.title}" class="max-h-80 object-contain">
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-indigo-600 mb-4">${formatCurrency(product.price)}</div>
                        <div class="mb-6">
                            <span class="inline-block bg-gray-200 text-gray-700 px-2 py-1 rounded text-sm">${product.category}</span>
                        </div>
                        <p class="text-gray-700 mb-6">${product.description}</p>
                        <div class="flex items-center mb-6">
                            <label class="mr-3">Quantity:</label>
                            <div class="flex">
                                <button id="decrement-detail" class="bg-gray-200 px-3 py-1 rounded-l">-</button>
                                <input type="number" id="product-quantity" min="1" value="1" class="w-16 text-center border-y py-1">
                                <button id="increment-detail" class="bg-gray-200 px-3 py-1 rounded-r">+</button>
                            </div>
                        </div>
                        <button id="add-to-cart-detail" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-indigo-700 transition">
                            Add to Cart
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('product-detail-modal').classList.remove('hidden');

            // Add event listeners
            document.getElementById('increment-detail').addEventListener('click', () => {
                const input = document.getElementById('product-quantity');
                input.value = parseInt(input.value) + 1;
            });

            document.getElementById('decrement-detail').addEventListener('click', () => {
                const input = document.getElementById('product-quantity');
                if (parseInt(input.value) > 1) {
                    input.value = parseInt(input.value) - 1;
                }
            });

            document.getElementById('add-to-cart-detail').addEventListener('click', () => {
                const quantity = parseInt(document.getElementById('product-quantity').value);
                if (quantity > 0) {
                    addToCart(state.currentProduct, quantity);
                    closeModal('product-detail-modal');
                }
            });

            modalEventListeners();
        }

        function openEditProductModal(product) {
            state.currentProductToEdit = product;

            // Fill form with product data
            const form = document.getElementById('edit-product-form');
            form.elements['id'].value = product.id;
            form.elements['title'].value = product.title;
            form.elements['price'].value = product.price;
            form.elements['category'].value = product.category;
            form.elements['description'].value = product.description;
            form.elements['image'].value = product.image;

            document.getElementById('edit-product-modal').classList.remove('hidden');
            modalEventListeners();
        }

        function openDeleteConfirmModal() {
            document.getElementById('delete-confirm-modal').classList.remove('hidden');
            modalEventListeners();

            document.getElementById('confirm-delete-button').addEventListener('click', async () => {
                if (state.currentProductToDelete) {
                    try {
                        await api.deleteProduct(state.currentProductToDelete.id);
                        showToast(`Product "${state.currentProductToDelete.title}" deleted successfully`);
                        closeModal('delete-confirm-modal');
                        renderAdminProductsTable();
                    } catch (error) {
                        showToast('Failed to delete product', 'error');
                    }
                }
            });
        }

        function openCartPanel() {
            document.getElementById('cart-panel').style.right = '0';
        }

        function closeCartPanel() {
            document.getElementById('cart-panel').style.right = '-100%';
        }

        function openCheckoutModal() {
            document.getElementById('checkout-modal').classList.remove('hidden');
            modalEventListeners();
        }

        function openConfirmationModal(order) {
            document.getElementById('order-number').textContent = order.id;
            document.getElementById('confirmation-modal').classList.remove('hidden');

            document.getElementById('close-confirmation').addEventListener('click', () => {
                closeModal('confirmation-modal');
            });
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function modalEventListeners() {
            // Close modals when clicking close buttons or overlay
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', () => {
                    button.closest('[id$="-modal"]').classList.add('hidden');
                });
            });

            document.querySelectorAll('.overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.closest('[id$="-modal"]').classList.add('hidden');
                    }
                });
            });
        }

        // Navigation functions
        function showView(viewName) {
            state.view = viewName;

            // Hide all sections first
            document.getElementById('product-catalog').classList.add('hidden');
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('order-history').classList.add('hidden');

            // Show the selected view
            if (viewName === 'catalog') {
                document.getElementById('product-catalog').classList.remove('hidden');
            } else if (viewName === 'admin') {
                document.getElementById('admin-dashboard').classList.remove('hidden');
                renderAdminProductsTable();
            } else if (viewName === 'history') {
                document.getElementById('order-history').classList.remove('hidden');
                renderOrderHistory();
            }
        }

        // Event handlers
        function setupEventListeners() {
            // Toggle cart panel
            document.getElementById('cart-button').addEventListener('click', openCartPanel);
            document.getElementById('close-cart').addEventListener('click', closeCartPanel);

            // Navigation
            document.getElementById('admin-toggle').addEventListener('click', () => showView('admin'));
            document.getElementById('mobile-admin-toggle').addEventListener('click', () => showView('admin'));
            document.getElementById('order-history-link').addEventListener('click', () => showView('history'));
            document.getElementById('mobile-order-history').addEventListener('click', () => showView('history'));

            // Checkout
            document.getElementById('checkout-button').addEventListener('click', openCheckoutModal);

            document.getElementById('checkout-form').addEventListener('submit', async (e) => {
                e.preventDefault();

                try {
                    const form = e.target;
                    const formData = {
                        firstName: form.elements['firstName'].value,
                        lastName: form.elements['lastName'].value,
                        email: form.elements['email'].value,
                        phone: form.elements['phone'].value,
                        address: form.elements['address'].value,
                        city: form.elements['city'].value,
                        postalCode: form.elements['postalCode'].value,
                        cardNumber: form.elements['cardNumber'].value,
                        expDate: form.elements['expDate'].value,
                        cvv: form.elements['cvv'].value
                    };

                    // Submit the order
                    const order = await api.submitOrder(formData);

                    // Clear the cart
                    clearCart();

                    // Close checkout modal and cart panel
                    closeModal('checkout-modal');
                    closeCartPanel();

                    // Show confirmation
                    openConfirmationModal(order);
                } catch (error) {
                    showToast('Failed to process your order. Please try again.', 'error');
                }
            });

            // Add product form
            document.getElementById('add-product-form').addEventListener('submit', async (e) => {
                e.preventDefault();

                try {
                    const form = e.target;
                    const productData = {
                        title: form.elements['title'].value,
                        price: parseFloat(form.elements['price'].value),
                        category: form.elements['category'].value,
                        description: form.elements['description'].value,
                        image: form.elements['image'].value
                    };

                    await api.addProduct(productData);
                    showToast('Product added successfully!');
                    form.reset();
                    renderAdminProductsTable();
                } catch (error) {
                    showToast('Failed to add product', 'error');
                }
            });

            document.getElementById('cancel-add-product').addEventListener('click', () => {
                document.getElementById('add-product-form').reset();
            });

            // Edit product form
            document.getElementById('edit-product-form').addEventListener('submit', async (e) => {
                e.preventDefault();

                try {
                    const form = e.target;
                    const productId = parseInt(form.elements['id'].value);
                    const productData = {
                        id: productId,
                        title: form.elements['title'].value,
                        price: parseFloat(form.elements['price'].value),
                        category: form.elements['category'].value,
                        description: form.elements['description'].value,
                        image: form.elements['image'].value
                    };

                    await api.updateProduct(productId, productData);
                    showToast('Product updated successfully!');
                    closeModal('edit-product-modal');
                    renderAdminProductsTable();
                } catch (error) {
                    showToast('Failed to update product', 'error');
                }
            });
        }

        // Initialize the app
        async function init() {
            loadFromLocalStorage();
            setupEventListeners();

            try {
                state.products = await api.getProducts();
                renderProducts();
                showView('catalog');
            } catch (error) {
                showToast('Failed to load products. Please refresh the page.', 'error');
            }
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>